<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ğŸš™CPMğŸš™ã‚·ãƒ§ãƒƒãƒ—</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #fef6f9;
      margin: 0;
      padding: 20px;
    }
    h1, h2 {
      text-align: center;
      color: #d6336c;
    }
    .hidden { display: none; }
    .products, .cart-items {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      padding: 10px;
    }
    .product, .cart-item {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      overflow: hidden;
      transition: transform 0.2s;
    }
    .product:hover, .cart-item:hover { transform: scale(1.03); }
    .product img, .cart-item img {
      width: 100%;
      height: 180px;
      object-fit: cover;
    }
    .details {
      padding: 15px;
    }
    .product-title { font-size: 18px; margin: 0 0 10px; }
    .product-price { color: #d6336c; font-weight: bold; margin-bottom: 10px; }
    .button {
      background: #ff8fb1;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
    }
    .button:hover { background: #ff5c8a; }
    .nav { text-align: center; margin: 20px; }
    .form-input {
      display: block;
      margin: 10px auto;
      padding: 10px;
      font-size: 14px;
      width: 80%;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
  </style>
</head>
<body>

<h1 id="main-title">CPM ä¾é ¼ã‚µã‚¤ãƒˆ</h1>

<!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
<div class="nav" id="nav">
  <button class="button" onclick="showPage('shop')">å•†å“ä¸€è¦§</button>
  <button class="button" onclick="showPage('cart')">ã‚«ãƒ¼ãƒˆã‚’è¦‹ã‚‹</button>
</div>

<!-- æ•´å‚™ä¸­ãƒšãƒ¼ã‚¸ -->
<div id="maintenance-page" class="hidden">
  <h2 style="text-align:center; margin-top: 100px; font-size: 32px; color: #d6336c;">ğŸš§ åªä»Šæ•´å‚™ä¸­ã§ã™ ğŸš§</h2>
  <p style="text-align:center;">ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚</p>
</div>

<!-- å•†å“ä¸€è¦§ -->
<div id="shop-page">
  <div class="products" id="product-list"></div>
</div>

<!-- ã‚«ãƒ¼ãƒˆãƒšãƒ¼ã‚¸ -->
<div id="cart-page" class="hidden">
  <h2>ğŸ›’ ã‚«ãƒ¼ãƒˆã®ä¸­èº«</h2>
  <div class="cart-items" id="cart-items"></div>
  <div style="text-align:center; margin-top: 10px; font-weight: bold; font-size: 16px; color: #d6336c;">
    åˆè¨ˆé‡‘é¡: <span id="cart-total">Â¥0</span>
  </div>
  <input type="text" id="buyer-name" class="form-input" placeholder="ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" />
  <input type="text" id="discord-id" class="form-input" placeholder="Discord IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" />
  <div style="text-align:center; margin-top:20px;">
    <button class="button" onclick="confirmOrder()">æ³¨æ–‡ã‚’ç¢ºå®šã™ã‚‹</button>
  </div>
</div>

<!-- ç¢ºèªãƒšãƒ¼ã‚¸ -->
<div id="confirm-page" class="hidden">
  <h2>âœ… æ³¨æ–‡ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼</h2>
  <p style="text-align:center;">æ³¨æ–‡å†…å®¹ã¯Discordã«é€ä¿¡ã•ã‚Œã¾ã—ãŸã€‚</p>
  <div style="text-align:center; margin-top:20px;">
    <button class="button" onclick="clearCart(); showPage('shop')">ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹</button>
  </div>
</div>

<script>
const products = [
  { id: 1, name: "CPM IDæŒ‡å®šå¢", price: 200, img: "https://raw.githubusercontent.com/hackparking/iraisaito/refs/heads/main/images/product1.jpg" },
  { id: 2, name: "CPM ã‚³ã‚¤ãƒ³ãƒãƒ¼ãƒˆ", price: 300, img: "https://raw.githubusercontent.com/hackparking/iraisaito/refs/heads/main/images/product2.jpg" },
  { id: 3, name: "CPM èª²é‡‘ãƒã‚¦ã‚¹è§£æ”¾", price: 120, img: "https://raw.githubusercontent.com/hackparking/iraisaito/refs/heads/main/images/product3.jpg" },
  { id: 4, name: "CPM èª²é‡‘ã‚¨ãƒ³ã‚¸ãƒ³è§£æ”¾", price: 210, img: "https://raw.githubusercontent.com/hackparking/iraisaito/refs/heads/main/images/product4.jpg" }
];

let cart = JSON.parse(localStorage.getItem("cart")) || [];

function showPage(page) {
  document.getElementById("shop-page").classList.add("hidden");
  document.getElementById("cart-page").classList.add("hidden");
  document.getElementById("confirm-page").classList.add("hidden");
  document.getElementById(`${page}-page`).classList.remove("hidden");
  if (page === "cart") renderCart();
  if (page === "shop") renderProducts();
}

function renderProducts() {
  const container = document.getElementById("product-list");
  container.innerHTML = "";
  products.forEach(p => {
    container.innerHTML += `
      <div class="product">
        <img src="${p.img}" alt="${p.name}" />
        <div class="details">
          <h2 class="product-title">${p.name}</h2>
          <p class="product-price">Â¥${p.price}</p>
          <button class="button" onclick="addToCart(${p.id})">ã‚«ãƒ¼ãƒˆã«è¿½åŠ </button>
        </div>
      </div>`;
  });
}

function addToCart(id) {
  const item = products.find(p => p.id === id);
  cart.push(item);
  localStorage.setItem("cart", JSON.stringify(cart));
  alert("ã‚«ãƒ¼ãƒˆã«è¿½åŠ ã—ã¾ã—ãŸï¼");
}

function renderCart() {
  const container = document.getElementById("cart-items");
  const totalElement = document.getElementById("cart-total");
  container.innerHTML = "";
  let total = 0;

  cart.forEach(item => {
    total += item.price;
    container.innerHTML += `
      <div class="cart-item">
        <img src="${item.img}" alt="${item.name}" />
        <div class="details">
          <h2 class="product-title">${item.name}</h2>
          <p class="product-price">Â¥${item.price}</p>
        </div>
      </div>`;
  });

  totalElement.textContent = `Â¥${total}`;
}

function confirmOrder() {
  if (cart.length === 0) {
    alert("ã‚«ãƒ¼ãƒˆãŒç©ºã§ã™ï¼");
    return;
  }

  const name = document.getElementById("buyer-name").value.trim();
  const discord = document.getElementById("discord-id").value.trim();
  if (!name || !discord) {
    alert("åå‰ã¨Discord IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
    return;
  }

  let content = `ğŸ›ï¸ æ–°ã—ã„æ³¨æ–‡ãŒå±Šãã¾ã—ãŸï¼\n\nè³¼å…¥è€…: ${name}\nDiscord ID: ${discord}\n\n`;
  let total = 0;
  cart.forEach(item => {
    content += `ãƒ»${item.name}ï¼ˆÂ¥${item.price}ï¼‰\n`;
    total += item.price;
  });
  content += `\nåˆè¨ˆ: Â¥${total}`;

  const webhookURL = "https://discord.com/api/webhooks/1357962919941374044/cZgh_HNfVLUV3SqeHyweqeO314CeIU3ibmHIrsF039kihZ6DdmUA2S2BW9l3RsiEB961";
  fetch(webhookURL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ content })
  }).then(() => {
    showPage("confirm");
  }).catch(() => {
    alert("æ³¨æ–‡é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ");
  });
}

function clearCart() {
  cart = [];
  localStorage.removeItem("cart");
}

// æ•´å‚™ä¸­åˆ¤å®šï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥é˜²æ­¢ä»˜ãï¼‰
fetch("maintenance.txt?nocache=" + new Date().getTime())
  .then(res => res.text())
  .then(status => {
    if (status.trim() === "0") {
      document.getElementById("shop-page").classList.add("hidden");
      document.getElementById("cart-page").classList.add("hidden");
      document.getElementById("confirm-page").classList.add("hidden");
      document.getElementById("nav").classList.add("hidden");
      document.getElementById("main-title").classList.add("hidden");
      document.getElementById("maintenance-page").classList.remove("hidden");
    } else {
      renderProducts();
    }
  })
  .catch(err => {
    console.error("maintenance.txt ã®èª­ã¿è¾¼ã¿å¤±æ•—", err);
    renderProducts(); // å¤±æ•—æ™‚ã¯é€šå¸¸è¡¨ç¤º
  });
</script>
</body>
</html>
